import sys
from PyQt5 import QtWidgets, QtGui, QtCore
from PyQt5.QtWidgets import QLabel, QVBoxLayout, QWidget
import requests
from io import BytesIO
from PIL import Image

class MapViewer(QWidget):
    def __init__(self, latitude, longitude, scale):
        super().__init__()
        self.latitude = latitude
        self.longitude = longitude
        self.scale = scale
        self.initUI()

    def initUI(self):
        self.setWindowTitle('Map Viewer')
        layout = QVBoxLayout()

        self.map_label = QLabel(self)
        layout.addWidget(self.map_label)

        self.setLayout(layout)
        self.show_map()

    def show_map(self):
        map_params = {
            "ll": f"{self.longitude},{self.latitude}",
            "spn": f"{self.scale},{self.scale}",
            "l": "map"
        }

        map_api_server = "https://static-maps.yandex.ru/v1"
        response = requests.get(map_api_server, params=map_params)

        if response.status_code == 200:
            try:
                im = Image.open(BytesIO(response.content))
                im.save("map.png")
                pixmap = QtGui.QPixmap("map.png")
                self.map_label.setPixmap(pixmap)
            except Exception as e:
                print("Ошибка при открытии изображения:", e)
        else:
            print("Ошибка при получении карты:", response.status_code)
            print("Содержимое ответа:", response.text)

if __name__ == '__main__':
    app = QtWidgets.QApplication(sys.argv)
    latitude = 55.7558 #тип корды Москвы 
    longitude = 37.6173  
    scale = 0.01 
    viewer = MapViewer(latitude, longitude, scale)
    viewer.resize(800, 600)
    sys.exit(app.exec_())
